#!/bin/bash

set -e

export XDG_CONFIG_HOME=$HOME/.config

### zim (zsh config manager)
# https://github.com/zimfw/zimfw
zsh $XDG_CONFIG_HOME/zsh/zim/zimfw.zsh upgrade
zsh $XDG_CONFIG_HOME/zsh/zim/zimfw.zsh install
zsh $XDG_CONFIG_HOME/zsh/zim/zimfw.zsh update

### Setup fzf (fuzzy finder)
# https://github.com/junegunn/fzf
FZFDIR=$XDG_CONFIG_HOME/fzf
git clone --depth 1 "https://github.com/junegunn/fzf.git" "$FZFDIR" 2> /dev/null || (cd "$FZFDIR" ; git pull)
$FZFDIR/install --xdg --completion --key-bindings --update-rc

# Install npm/node with nvm, Install yarn with npm. (For vim stuff)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
export NVM_DIR="$([ -z "${XDG_CONFIG_HOME-}" ] && printf %s "${HOME}/.nvm" || printf %s "${XDG_CONFIG_HOME}/nvm")"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh" # This loads nvm
nvm install node
npm install -g yarn neovim

# Install perl stuff (just for neovim, probably useless...)
# PLENV_DIR=$HOME/.plenv
# git clone https://github.com/tokuhirom/plenv.git $PLENV_DIR 2> /dev/null || (cd "$PLENV_DIR" ; git pull)
# export PATH="$PLENV_DIR/bin:$PATH"
# eval "$(plenv init -)"
# PB_DIR=$PLENV_DIR/plugins/perl-build/
# git clone https://github.com/tokuhirom/Perl-Build.git $PB_DIR 2> /dev/null || (cd "$PB_DIR" ; git pull)
#
# CPANM_DIR=$HOME/perl5/bin
# if [ ! -d "$CPANM_DIR" ]; then
#   plenv install-cpanm
# fi

# Install vim stuff


VIM_DIR=$XDG_CONFIG_HOME/nvim

# Get spellfiles
mkdir -p $VIM_DIR/spell
cd $VIM_DIR//spell
wget -c -N http://ftp.vim.org/pub/vim/runtime/spell/{de,en}.utf-8.{spl,sug}
cd
mkdir -p $VIM_DIR/undodir
mkdir -p $VIM_DIR/tmp/backup
nvim '+PlugUpgrade' '+PlugClean!' '+PlugInstall' '+qall'
